
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
      
      
      
      
      <link rel="icon" href="../../../../images/favicon.png">
      <meta name="generator" content="mkdocs-1.4.2, mkdocs-material-9.1.3">
    
    
      
        <title>Nutanix CSI Driver installation with CAPX - opendocs.nutanix.com</title>
      
    
    
      <link rel="stylesheet" href="../../../../assets/stylesheets/main.c4a75a56.min.css">
      
        
        <link rel="stylesheet" href="../../../../assets/stylesheets/palette.a0c5b2b5.min.css">
      
      
  
  
    
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M14 10V4.5l5.5 5.5M5 3c-1.11 0-2 .89-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2V9l-6-6H5Z"/></svg>');}</style>


    
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Roboto:300,300i,400,400i,700,700i%7CRoboto+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Roboto";--md-code-font:"Roboto Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../../../../stylesheets/extra.css">
    
    <script>__md_scope=new URL("../../../..",location),__md_hash=e=>[...e].reduce((e,_)=>(e<<5)-e+_.charCodeAt(0),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
    
  </head>
  
  
    
    
    
    
    
    <body dir="ltr" data-md-color-scheme="default" data-md-color-primary="" data-md-color-accent="">
  
    
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#nutanix-csi-driver-installation-with-capx" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      

  

<header class="md-header md-header--shadow" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">
    <a href="../../../.." title="opendocs.nutanix.com" class="md-header__button md-logo" aria-label="opendocs.nutanix.com" data-md-component="logo">
      
  <img src="../../../../images/nutanix_x_white.png" alt="logo">

    </a>
    <label class="md-header__button md-icon" for="__drawer">
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3V6m0 5h18v2H3v-2m0 5h18v2H3v-2Z"/></svg>
    </label>
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            opendocs.nutanix.com
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
              Nutanix CSI Driver installation with CAPX
            
          </span>
        </div>
      </div>
    </div>
    
    
    
      <label class="md-header__button md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
      </label>
      <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.516 6.516 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5Z"/></svg>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11h12Z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12 19 6.41Z"/></svg>
        </button>
      </nav>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    
      <div class="md-header__source">
        <a href="https://github.com/nutanix-cloud-native/opendocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    nutanix-cloud-native/opendocs
  </div>
</a>
      </div>
    
  </nav>
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


<nav class="md-nav md-nav--primary" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href="../../../.." title="opendocs.nutanix.com" class="md-nav__button md-logo" aria-label="opendocs.nutanix.com" data-md-component="logo">
      
  <img src="../../../../images/nutanix_x_white.png" alt="logo">

    </a>
    opendocs.nutanix.com
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nutanix-cloud-native/opendocs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 6.3.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2023 Fonticons, Inc.--><path d="M439.55 236.05 244 40.45a28.87 28.87 0 0 0-40.81 0l-40.66 40.63 51.52 51.52c27.06-9.14 52.68 16.77 43.39 43.68l49.66 49.66c34.23-11.8 61.18 31 35.47 56.69-26.49 26.49-70.21-2.87-56-37.34L240.22 199v121.85c25.3 12.54 22.26 41.85 9.08 55a34.34 34.34 0 0 1-48.55 0c-17.57-17.6-11.07-46.91 11.25-56v-123c-20.8-8.51-24.6-30.74-18.64-45L142.57 101 8.45 235.14a28.86 28.86 0 0 0 0 40.81l195.61 195.6a28.86 28.86 0 0 0 40.8 0l194.69-194.69a28.86 28.86 0 0 0 0-40.81z"/></svg>
  </div>
  <div class="md-source__repository">
    nutanix-cloud-native/opendocs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
      

  
  
  
    <li class="md-nav__item">
      <a href="../../../.." class="md-nav__link">
        Nutanix Cloud Native
      </a>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2" id="__nav_2_label" tabindex="0">
          Cluster API Provider: Nutanix (CAPX)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2">
          <span class="md-nav__icon md-icon"></span>
          Cluster API Provider: Nutanix (CAPX)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1" id="__nav_2_1_label" tabindex="0">
          v1.1.x (Latest)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1">
          <span class="md-nav__icon md-icon"></span>
          v1.1.x (Latest)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1_2" id="__nav_2_1_2_label" tabindex="0">
          Types
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1_2">
          <span class="md-nav__icon md-icon"></span>
          Types
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/types/nutanix_cluster/" class="md-nav__link">
        NutanixCluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/types/nutanix_machine_template/" class="md-nav__link">
        NutanixMachineTemplate
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/pc_certificates/" class="md-nav__link">
        Certificate Trust
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/credential_management/" class="md-nav__link">
        Credential Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_5" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1_5" id="__nav_2_1_5_label" tabindex="0">
          Tasks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1_5">
          <span class="md-nav__icon md-icon"></span>
          Tasks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/tasks/modify_machine_configuration/" class="md-nav__link">
        Modifying Machine Configuration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/port_requirements/" class="md-nav__link">
        Port Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_7" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1_7" id="__nav_2_1_7_label" tabindex="0">
          Addons
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_7_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1_7">
          <span class="md-nav__icon md-icon"></span>
          Addons
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/addons/install_csi_driver/" class="md-nav__link">
        CSI Driver Installation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/validated_integrations/" class="md-nav__link">
        Validated Integrations
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_1_9" >
      
      
      
        <label class="md-nav__link" for="__nav_2_1_9" id="__nav_2_1_9_label" tabindex="0">
          Experimental
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_1_9_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_1_9">
          <span class="md-nav__icon md-icon"></span>
          Experimental
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/experimental/capx_multi_pe/" class="md-nav__link">
        Multi-PE CAPX cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/experimental/autoscaler/" class="md-nav__link">
        Autoscaler
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/experimental/oidc/" class="md-nav__link">
        OIDC Integration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/experimental/vpc/" class="md-nav__link">
        Flow VPC
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/experimental/proxy/" class="md-nav__link">
        Proxy Configuration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.1.x/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2" id="__nav_2_2_label" tabindex="0">
          v1.0.x
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2">
          <span class="md-nav__icon md-icon"></span>
          v1.0.x
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_2" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2_2" id="__nav_2_2_2_label" tabindex="0">
          Types
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_2">
          <span class="md-nav__icon md-icon"></span>
          Types
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/types/nutanix_cluster/" class="md-nav__link">
        NutanixCluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/types/nutanix_machine_template/" class="md-nav__link">
        NutanixMachineTemplate
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/credential_management/" class="md-nav__link">
        Credential Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_4" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2_4" id="__nav_2_2_4_label" tabindex="0">
          Tasks
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_4">
          <span class="md-nav__icon md-icon"></span>
          Tasks
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/tasks/modify_machine_configuration/" class="md-nav__link">
        Modifying Machine Configuration
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/port_requirements/" class="md-nav__link">
        Port Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_6" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2_6" id="__nav_2_2_6_label" tabindex="0">
          Addons
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_6_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_6">
          <span class="md-nav__icon md-icon"></span>
          Addons
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/addons/install_csi_driver/" class="md-nav__link">
        CSI Driver Installation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/validated_integrations/" class="md-nav__link">
        Validated Integrations
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_2_8" >
      
      
      
        <label class="md-nav__link" for="__nav_2_2_8" id="__nav_2_2_8_label" tabindex="0">
          Experimental
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_2_8_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_2_8">
          <span class="md-nav__icon md-icon"></span>
          Experimental
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/experimental/capx_multi_pe/" class="md-nav__link">
        Multi-PE CAPX cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/experimental/autoscaler/" class="md-nav__link">
        Autoscaler
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v1.0.x/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3" id="__nav_2_3_label" tabindex="0">
          v0.5.x
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_2_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3">
          <span class="md-nav__icon md-icon"></span>
          v0.5.x
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v0.5.x/getting_started/" class="md-nav__link">
        Getting Started
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v0.5.x/credential_management/" class="md-nav__link">
        Credential Management
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_3" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3_3" id="__nav_2_3_3_label" tabindex="0">
          Addons
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3_3">
          <span class="md-nav__icon md-icon"></span>
          Addons
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v0.5.x/addons/install_csi_driver/" class="md-nav__link">
        CSI Driver Installation
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v0.5.x/validated_integrations/" class="md-nav__link">
        Validated Integrations
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_2_3_5" >
      
      
      
        <label class="md-nav__link" for="__nav_2_3_5" id="__nav_2_3_5_label" tabindex="0">
          Experimental
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="3" aria-labelledby="__nav_2_3_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_2_3_5">
          <span class="md-nav__icon md-icon"></span>
          Experimental
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v0.5.x/experimental/capx_multi_pe/" class="md-nav__link">
        Multi-PE CAPX cluster
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v0.5.x/experimental/autoscaler/" class="md-nav__link">
        Autoscaler
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../v0.5.x/troubleshooting/" class="md-nav__link">
        Troubleshooting
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3" >
      
      
      
        <label class="md-nav__link" for="__nav_3" id="__nav_3_label" tabindex="0">
          Nutanix Cloud Controller Manager (CCM)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3">
          <span class="md-nav__icon md-icon"></span>
          Nutanix Cloud Controller Manager (CCM)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_1" >
      
      
      
        <label class="md-nav__link" for="__nav_3_1" id="__nav_3_1_label" tabindex="0">
          v0.3.x (Latest)
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_1">
          <span class="md-nav__icon md-icon"></span>
          v0.3.x (Latest)
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.3.x/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.3.x/requirements/" class="md-nav__link">
        Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.3.x/ccm_configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.3.x/pc_certificates/" class="md-nav__link">
        Certificate Trust
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.3.x/ccm_credentials/" class="md-nav__link">
        Credentials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.3.x/topology_discovery/" class="md-nav__link">
        Topology Discovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.3.x/custom_labeling/" class="md-nav__link">
        Custom Labeling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_3_2" >
      
      
      
        <label class="md-nav__link" for="__nav_3_2" id="__nav_3_2_label" tabindex="0">
          v0.2.0
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_3_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_3_2">
          <span class="md-nav__icon md-icon"></span>
          v0.2.0
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.2.x/overview/" class="md-nav__link">
        Overview
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.2.x/requirements/" class="md-nav__link">
        Requirements
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.2.x/ccm_configuration/" class="md-nav__link">
        Configuration
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.2.x/ccm_credentials/" class="md-nav__link">
        Credentials
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.2.x/topology_discovery/" class="md-nav__link">
        Topology Discovery
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../ccm/v0.2.x/custom_labeling/" class="md-nav__link">
        Custom Labeling
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4" >
      
      
      
        <label class="md-nav__link" for="__nav_4" id="__nav_4_label" tabindex="0">
          Red Hat OpenShift
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_4_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4">
          <span class="md-nav__icon md-icon"></span>
          Red Hat OpenShift
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_1" >
      
      
      
        <label class="md-nav__link" for="__nav_4_1" id="__nav_4_1_label" tabindex="0">
          Install
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_1_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_1">
          <span class="md-nav__icon md-icon"></span>
          Install
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../openshift/install/agnostic/" class="md-nav__link">
        Agnostic
      </a>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../openshift/install/ipi/" class="md-nav__link">
        IPI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../openshift/post-install/" class="md-nav__link">
        Post Install
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_4_3" >
      
      
      
        <label class="md-nav__link" for="__nav_4_3" id="__nav_4_3_label" tabindex="0">
          Operators
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_4_3_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_4_3">
          <span class="md-nav__icon md-icon"></span>
          Operators
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../openshift/operators/csi/" class="md-nav__link">
        CSI
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
      
      
      

  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5" >
      
      
      
        <label class="md-nav__link" for="__nav_5" id="__nav_5_label" tabindex="0">
          Google Anthos
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="1" aria-labelledby="__nav_5_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5">
          <span class="md-nav__icon md-icon"></span>
          Google Anthos
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../anthos/architecture/" class="md-nav__link">
        Architecture
      </a>
    </li>
  

            
          
            
              
  
  
  
    
    <li class="md-nav__item md-nav__item--nested">
      
      
      
      
      <input class="md-nav__toggle md-toggle " type="checkbox" id="__nav_5_2" >
      
      
      
        <label class="md-nav__link" for="__nav_5_2" id="__nav_5_2_label" tabindex="0">
          Install
          <span class="md-nav__icon md-icon"></span>
        </label>
      
      <nav class="md-nav" data-md-level="2" aria-labelledby="__nav_5_2_label" aria-expanded="false">
        <label class="md-nav__title" for="__nav_5_2">
          <span class="md-nav__icon md-icon"></span>
          Install
        </label>
        <ul class="md-nav__list" data-md-scrollfix>
          
            
              
  
  
  
    <li class="md-nav__item">
      <a href="../../../../anthos/install/manual/" class="md-nav__link">
        Manual
      </a>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

            
          
        </ul>
      </nav>
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
    
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#capi-workload-cluster-prerequisites-for-the-nutanix-csi-driver" class="md-nav__link">
    CAPI Workload cluster prerequisites for the Nutanix CSI Driver
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-nutanix-csi-driver-with-helm" class="md-nav__link">
    Install the Nutanix CSI Driver with Helm
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-nutanix-csi-driver-with-clusterresourceset" class="md-nav__link">
    Install the Nutanix CSI Driver with ClusterResourceSet
  </a>
  
    <nav class="md-nav" aria-label="Install the Nutanix CSI Driver with ClusterResourceSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#enabling-the-clusterresourceset-feature" class="md-nav__link">
    Enabling the ClusterResourceSet feature
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#prepare-the-nutanix-csi-clusterresourceset" class="md-nav__link">
    Prepare the Nutanix CSI ClusterResourceSet
  </a>
  
    <nav class="md-nav" aria-label="Prepare the Nutanix CSI ClusterResourceSet">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#create-the-configmap-for-the-cni-plugin" class="md-nav__link">
    Create the ConfigMap for the CNI Plugin
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#create-the-clusterresourceset" class="md-nav__link">
    Create the ClusterResourceSet
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#assign-the-clusterresourceset-to-a-workload-cluster" class="md-nav__link">
    Assign the ClusterResourceSet to a workload cluster
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#install-the-nutanix-csi-driver-with-a-capx-flavor" class="md-nav__link">
    Install the Nutanix CSI Driver with a CAPX flavor
  </a>
  
    <nav class="md-nav" aria-label="Install the Nutanix CSI Driver with a CAPX flavor">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#prerequisites" class="md-nav__link">
    Prerequisites
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#installation" class="md-nav__link">
    Installation
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
        <li class="md-nav__item">
  <a href="#nutanix-csi-driver-configuration" class="md-nav__link">
    Nutanix CSI Driver Configuration
  </a>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              <article class="md-content__inner md-typeset">
                
                  


<h1 id="nutanix-csi-driver-installation-with-capx">Nutanix CSI Driver installation with CAPX</h1>
<p>The Nutanix CSI driver is fully supported on CAPI/CAPX deployed clusters where all the nodes meet the <a href="#capi-workload-cluster-prerequisites-for-the-nutanix-csi-driver">Nutanix CSI driver prerequisites</a>.</p>
<p>There are three methods to install the Nutanix CSI driver on a CAPI/CAPX cluster:</p>
<ul>
<li>Helm</li>
<li>ClusterResourceSet</li>
<li>CAPX Flavor</li>
</ul>
<p>For more information, check the next sections.</p>
<h2 id="capi-workload-cluster-prerequisites-for-the-nutanix-csi-driver">CAPI Workload cluster prerequisites for the Nutanix CSI Driver</h2>
<p>Kubernetes workers need the following prerequisites to use the Nutanix CSI Drivers:</p>
<ul>
<li>iSCSI initiator package (for Volumes based block storage)</li>
<li>NFS client package (for Files based storage)</li>
</ul>
<p>These packages may already be present in the image you use with your infrastructure provider or you can also rely on your bootstrap provider to install them. More info is available in the <a href="https://portal.nutanix.com/page/documents/details?targetId=CSI-Volume-Driver-v2_6:csi-csi-plugin-prerequisites-r.html" target="_blank">Prerequisites docs</a>.</p>
<p>The package names and installation method will also vary depending on the operating system you plan to use.</p>
<p>In the example below, <code>kubeadm</code> bootstrap provider is used to deploy these packages on top of an Ubuntu 20.04 image. The <code>kubeadm</code> bootstrap provider allows defining <code>preKubeadmCommands</code> that will be launched before Kubernetes cluster creation. These <code>preKubeadmCommands</code> can be defined both in <code>KubeadmControlPlane</code> for master nodes and in <code>KubeadmConfigTemplate</code> for worker nodes.</p>
<p>In the example with an Ubuntu 20.04 image, both <code>KubeadmControlPlane</code> and <code>KubeadmConfigTemplate</code> must be modified as in the example below:</p>
<div class="highlight"><pre><span></span><code><span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">template</span><span class="p">:</span>
<span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
<span class="w">      </span><span class="c1"># .......</span>
<span class="w">      </span><span class="nt">preKubeadmCommands</span><span class="p">:</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">echo &quot;before kubeadm call&quot; &gt; /var/log/prekubeadm.log</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apt update</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apt install -y nfs-common open-iscsi</span>
<span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">systemctl enable --now iscsid</span>
</code></pre></div>
<h2 id="install-the-nutanix-csi-driver-with-helm">Install the Nutanix CSI Driver with Helm</h2>
<p>A recent <a href="https://helm.sh" target="_blank">Helm</a> version is needed (tested with Helm v3.10.1).</p>
<p>The example below must be applied on a ready workload cluster. The workload cluster's kubeconfig can be retrieved and used to connect with the following command:</p>
<div class="highlight"><pre><span></span><code>clusterctl<span class="w"> </span>get<span class="w"> </span>kubeconfig<span class="w"> </span><span class="nv">$CLUSTER_NAME</span><span class="w"> </span>-n<span class="w"> </span><span class="nv">$CLUSTER_NAMESPACE</span><span class="w"> </span>&gt;<span class="w"> </span><span class="nv">$CLUSTER_NAME</span>-KUBECONFIG
<span class="nb">export</span><span class="w"> </span><span class="nv">KUBECONFIG</span><span class="o">=</span><span class="k">$(</span><span class="nb">pwd</span><span class="k">)</span>/<span class="nv">$CLUSTER_NAME</span>-KUBECONFIG
</code></pre></div>
<p>Once connected to the cluster, follow the <a href="https://portal.nutanix.com/page/documents/details?targetId=CSI-Volume-Driver-v2_6:csi-csi-driver-install-t.html" target="_blank">CSI documentation</a>. </p>
<p>First, install the <a href="https://github.com/nutanix/helm/tree/master/charts/nutanix-csi-snapshot" target="_blank">nutanix-csi-snapshot</a> chart followed by the <a href="https://github.com/nutanix/helm/tree/master/charts/nutanix-csi-storage" target="_blank">nutanix-csi-storage</a> chart.</p>
<p>See an example below:</p>
<div class="highlight"><pre><span></span><code><span class="c1">#Add the official Nutanix Helm repo and get the latest update</span>
helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>nutanix<span class="w"> </span>https://nutanix.github.io/helm/
helm<span class="w"> </span>repo<span class="w"> </span>update

<span class="c1"># Install the nutanix-csi-snapshot chart</span>
helm<span class="w"> </span>install<span class="w"> </span>nutanix-csi-snapshot<span class="w"> </span>nutanix/nutanix-csi-snapshot<span class="w"> </span>-n<span class="w"> </span>ntnx-system<span class="w"> </span>--create-namespace

<span class="c1"># Install the nutanix-csi-storage chart</span>
helm<span class="w"> </span>install<span class="w"> </span>nutanix-storage<span class="w"> </span>nutanix/nutanix-csi-storage<span class="w"> </span>-n<span class="w"> </span>ntnx-system<span class="w"> </span>--set<span class="w"> </span><span class="nv">createSecret</span><span class="o">=</span><span class="nb">false</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For correct Nutanix CSI driver deployment, a fully functional CNI deployment must be present.</p>
</div>
<h2 id="install-the-nutanix-csi-driver-with-clusterresourceset">Install the Nutanix CSI Driver with <code>ClusterResourceSet</code></h2>
<p>The <code>ClusterResourceSet</code> feature was introduced to automatically apply a set of resources (such as CNI/CSI) defined by administrators to matching created/existing workload clusters.</p>
<h3 id="enabling-the-clusterresourceset-feature">Enabling the <code>ClusterResourceSet</code> feature</h3>
<p>At the time of writing, <code>ClusterResourceSet</code> is an experimental feature that must be enabled during the initialization of a management cluster with the <code>EXP_CLUSTER_RESOURCE_SET</code> feature gate.</p>
<p>To do this, add <code>EXP_CLUSTER_RESOURCE_SET: "true"</code> in the <code>clusterctl</code> configuration file or just <code>export EXP_CLUSTER_RESOURCE_SET=true</code> before initializing the management cluster with <code>clusterctl init</code>.</p>
<p>If the management cluster is already initialized, the <code>ClusterResourceSet</code> can be enabled by changing the configuration of the <code>capi-controller-manager</code> deployment in the <code>capi-system</code> namespace.</p>
<div class="highlight"><pre><span></span><code>kubectl<span class="w"> </span>edit<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>capi-system<span class="w"> </span>capi-controller-manager
</code></pre></div>
<p>Locate the section below:</p>
<div class="highlight"><pre><span></span><code><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">args</span><span class="p">:</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--leader-elect</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--metrics-bind-addr=localhost:8080</span>
<span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--feature-gates=MachinePool=false,ClusterResourceSet=true,ClusterTopology=false</span>
</code></pre></div>
<p>Then replace <code>ClusterResourceSet=false</code> with <code>ClusterResourceSet=true</code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Editing the <code>deployment</code> resource will cause Kubernetes to automatically start new versions of the containers with the feature enabled.</p>
</div>
<h3 id="prepare-the-nutanix-csi-clusterresourceset">Prepare the Nutanix CSI <code>ClusterResourceSet</code></h3>
<h4 id="create-the-configmap-for-the-cni-plugin">Create the <code>ConfigMap</code> for the CNI Plugin</h4>
<p>First, create a <code>ConfigMap</code> that contains a YAML manifest with all resources to install the Nutanix CSI driver.</p>
<p>Since the Nutanix CSI Driver is provided as a Helm chart, use <code>helm</code> to extract it before creating the <code>ConfigMap</code>. See an example below:</p>
<div class="highlight"><pre><span></span><code>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>nutanix<span class="w"> </span>https://nutanix.github.io/helm/
helm<span class="w"> </span>repo<span class="w"> </span>update

kubectl<span class="w"> </span>create<span class="w"> </span>ns<span class="w"> </span>ntnx-system<span class="w"> </span>--dry-run<span class="o">=</span>client<span class="w"> </span>-o<span class="w"> </span>yaml<span class="w"> </span>&gt;<span class="w"> </span>nutanix-csi-namespace.yaml
helm<span class="w"> </span>template<span class="w"> </span>nutanix-csi-snapshot<span class="w"> </span>nutanix/nutanix-csi-snapshot<span class="w"> </span>-n<span class="w"> </span>ntnx-system<span class="w"> </span>&gt;<span class="w"> </span>nutanix-csi-snapshot.yaml
helm<span class="w"> </span>template<span class="w"> </span>nutanix-csi-snapshot<span class="w"> </span>nutanix/nutanix-csi-storage<span class="w"> </span>-n<span class="w"> </span>ntnx-system<span class="w"> </span>&gt;<span class="w"> </span>nutanix-csi-storage.yaml

kubectl<span class="w"> </span>create<span class="w"> </span>configmap<span class="w"> </span>nutanix-csi-crs<span class="w"> </span>--from-file<span class="o">=</span>nutanix-csi-namespace.yaml<span class="w"> </span>--from-file<span class="o">=</span>nutanix-csi-snapshot.yaml<span class="w"> </span>--from-file<span class="o">=</span>nutanix-csi-storage.yaml
</code></pre></div>
<h4 id="create-the-clusterresourceset">Create the <code>ClusterResourceSet</code></h4>
<p>Next, create the <code>ClusterResourceSet</code> resource that will map the <code>ConfigMap</code> defined above to clusters using a <code>clusterSelector</code>.</p>
<p>The <code>ClusterResourceSet</code> needs to be created inside the management cluster. See an example below:</p>
<div class="highlight"><pre><span></span><code><span class="nn">---</span>
<span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">addons.cluster.x-k8s.io/v1alpha3</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ClusterResourceSet</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nutanix-csi-crs</span>
<span class="nt">spec</span><span class="p">:</span>
<span class="w">  </span><span class="nt">clusterSelector</span><span class="p">:</span>
<span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
<span class="w">      </span><span class="nt">csi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nutanix</span><span class="w"> </span>
<span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
<span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
<span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nutanix-csi-crs</span>
</code></pre></div>
<p>The <code>clusterSelector</code> field controls how Cluster API will match this <code>ClusterResourceSet</code> on one or more workload clusters. In the example scenario, the <code>matchLabels</code> approach is being used where the <code>ClusterResourceSet</code> will be applied to all workload clusters having the <code>csi: nutanix</code> label present. If the label isn't present, the <code>ClusterResourceSet</code> won't apply to that workload cluster.</p>
<p>The <code>resources</code> field references the <code>ConfigMap</code> created above, which contains the manifests for installing the Nutanix CSI driver.</p>
<h4 id="assign-the-clusterresourceset-to-a-workload-cluster">Assign the <code>ClusterResourceSet</code> to a workload cluster</h4>
<p>Assign this <code>ClusterResourceSet</code> to the workload cluster by adding the correct label to the <code>Cluster</code> resource.</p>
<p>This can be done before workload cluster creation by editing the output of the <code>clusterctl generate cluster</code> command or by modifying an already deployed workload cluster.</p>
<p>In both cases, <code>Cluster</code> resources should look like this:</p>
<div class="highlight"><pre><span></span><code><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">cluster.x-k8s.io/v1beta1</span>
<span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Cluster</span>
<span class="nt">metadata</span><span class="p">:</span>
<span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">workload-cluster-name</span>
<span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">workload-cluster-namespace</span>
<span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
<span class="w">    </span><span class="nt">csi</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nutanix</span>
<span class="c1"># ...</span>
</code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For correct Nutanix CSI driver deployment, a fully functional CNI deployment must be present.</p>
</div>
<h2 id="install-the-nutanix-csi-driver-with-a-capx-flavor">Install the Nutanix CSI Driver with a CAPX flavor</h2>
<p>The CAPX provider can utilize a flavor to automatically deploy the Nutanix CSI using a <code>ClusterResourceSet</code>.</p>
<h3 id="prerequisites">Prerequisites</h3>
<p>The following requirements must be met:</p>
<ul>
<li>The operating system must meet the <a href="#capi-workload-cluster-prerequisites-for-the-nutanix-csi-driver">Nutanix CSI OS prerequisites</a>.</li>
<li>The Management cluster must be installed with the <a href="#enabling-the-clusterresourceset-feature"><code>CLUSTER_RESOURCE_SET</code> feature gate</a>.</li>
</ul>
<h3 id="installation">Installation</h3>
<p>Specify the <code>csi</code> flavor during workload cluster creation. See an example below:</p>
<div class="highlight"><pre><span></span><code>clusterctl<span class="w"> </span>generate<span class="w"> </span>cluster<span class="w"> </span>my-cluster<span class="w"> </span>-f<span class="w"> </span>csi
</code></pre></div>
<p>Additional environment variables are required:</p>
<ul>
<li><code>WEBHOOK_CA</code>: Base64 encoded CA certificate used to sign the webhook certificate</li>
<li><code>WEBHOOK_CERT</code>: Base64 certificate for the webhook validation component</li>
<li><code>WEBHOOK_KEY</code>: Base64 key for the webhook validation component</li>
</ul>
<p>The three components referenced above can be automatically created and referenced using <a href="https://github.com/nutanix-cloud-native/cluster-api-provider-nutanix/blob/main/scripts/gen-self-cert.sh" target="_blank">this script</a>:</p>
<div class="highlight"><pre><span></span><code>source scripts/gen-self-cert.sh
</code></pre></div>
<p>The certificate must reference the following names:</p>
<ul>
<li>csi-snapshot-webhook</li>
<li>csi-snapshot-webhook.ntnx-sytem</li>
<li>csi-snapshot-webhook.ntnx-sytem.svc</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>For correct Nutanix CSI driver deployment, a fully functional CNI deployment must be present.</p>
</div>
<h2 id="nutanix-csi-driver-configuration">Nutanix CSI Driver Configuration</h2>
<p>After the driver is installed, it must be configured for use by minimally defining a <code>Secret</code> and <code>StorageClass</code>.</p>
<p>This can be done manually in the workload clusters or by using a <code>ClusterResourceSet</code> in the management cluster as explained above.</p>
<p>See the Official <a href="https://portal.nutanix.com/page/documents/details?targetId=CSI-Volume-Driver-v2_6:CSI-Volume-Driver-v2_6" target="_blank">CSI Driver documentation</a> on the Nutanix Portal for more configuration information. </p>





                
              </article>
            </div>
          
          
        </div>
        
      </main>
      
        <footer class="md-footer">
  
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      Copyright &copy; 2021 - 2022 Nutanix, Inc.
    </div>
  
  
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
    <script id="__config" type="application/json">{"base": "../../../..", "features": ["navigation.instant", "content.code.annotate"], "search": "../../../../assets/javascripts/workers/search.208ed371.min.js", "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}}</script>
    
    
      <script src="../../../../assets/javascripts/bundle.efa0ade1.min.js"></script>
      
    
  </body>
</html>